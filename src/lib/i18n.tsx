"use client";

import React, { createContext, useContext, useMemo, useState, ReactNode } from "react";

export type Locale = "en" | "hi" | "bn" | "ta" | "te";

type Messages = Record<string, string>;

type I18nContextType = {
  locale: Locale;
  setLocale: (l: Locale) => void;
  t: (key: string) => string;
};

const dictionaries: Record<Locale, Messages> = {
  en: {
    open_extension: "Open Extension",
    search_placeholder: "Search products, ASIN, URLs...",
    connected: "Connected",
    alerts: "Alerts",
    price_history: "Price History",
    price_history_desc: "Last year's price vs average",
    range: "Range",
    last_30_days: "Last 30 days",
    last_90_days: "Last 90 days",
    last_12_months: "Last 12 months",
    price_alerts: "Price Alerts",
    price_alerts_desc: "Get notified when price crosses thresholds",
    alert_below: "Alert when below",
    alert_above: "Alert when above",
    save_alerts: "Save Alerts",
    rating_trend: "Rating Trend",
    rating_trend_desc: "Average rating over time",
    total_ratings: "Total Ratings",
    total_ratings_desc: "Number of ratings over time",
    review_highlights: "Review Highlights",
    review_highlights_desc: "Top themes from recent reviews",
    scope: "Scope",
    data: "Data",
    languages: "Languages",
    lang_en: "English",
    lang_es: "Spanish",
    lang_de: "German",
    m_jan: "Jan",
    m_feb: "Feb",
    m_mar: "Mar",
    m_apr: "Apr",
    m_may: "May",
    m_jun: "Jun",
    m_jul: "Jul",
    m_aug: "Aug",
    m_sep: "Sep",
    m_oct: "Oct",
    m_nov: "Nov",
    m_dec: "Dec",
    keyword_extraction: "Keyword Extraction",
    keyword_extraction_desc: "Find important terms from reviews",
    run_extraction: "Run Extraction",
    analytics: "Analytics",
    dashboard: "Dashboard",
    price_tracking: "Price Tracking",
    reviews: "Reviews",
    keywords: "Keywords",
    price: "Price",
    avg: "Avg",
    send_alert_if_price_below: "Send alert if price <",
    send_alert_if_price_above: "Send alert if price >",
    rating: "Rating",
    ratings: "Ratings",
    last_50_reviews: "Last 50 reviews",
    last_100_reviews: "Last 100 reviews",
    last_6_months: "Last 6 months",
    pros: "Pros",
    cons: "Cons",
    notes: "Notes",
    weekly_views_vs_conversions: "Weekly views vs conversions",
    views: "Views",
    conversions: "Conversions",
    benchmarks: "Benchmarks",
    category_comparison: "Category comparison",
    ctr: "CTR",
    conversion_rate: "Conversion",
    refund_rate: "Refund Rate",
    source: "Source",
    language: "Language",
    n_grams: "N-grams",
    combinations: "Combinations",
    unigrams: "Unigrams",
    bigrams: "Bigrams",
    uni_bi: "Uni + Bi",
    uni_bi_tri: "Uni + Bi + Tri",
    min_occurrences: "Min occurrences",
    stopwords: "Stopwords",
    placeholder_stopwords: "comma,separated,words",
    must_include: "Must include",
    placeholder_include: "e.g. battery, display",
    deduplicate_terms: "Deduplicate similar terms",
    exclude_brand_terms: "Exclude brand terms",
    top_keywords: "Top Keywords",
    sorted_by_importance: "Sorted by importance",
    all_reviews: "All reviews",
    recent_reviews: "Recent reviews",
    qa: "Q&A",
  },
  hi: {
    open_extension: "एक्सटेंशन खोलें",
    search_placeholder: "उत्पाद, ASIN, URL खोजें...",
    connected: "कनेक्टेड",
    alerts: "अलर्ट",
    price_history: "कीमत का इतिहास",
    price_history_desc: "पिछले वर्ष की कीमत बनाम औसत",
    range: "रेंज",
    last_30_days: "पिछले 30 दिन",
    last_90_days: "पिछले 90 दिन",
    last_12_months: "पिछले 12 महीने",
    price_alerts: "कीमत अलर्ट",
    price_alerts_desc: "जब कीमत सीमा पार करे तो सूचित हों",
    alert_below: "नीचे होने पर अलर्ट",
    alert_above: "ऊपर होने पर अलर्ट",
    save_alerts: "अलर्ट सहेजें",
    rating_trend: "रेटिंग ट्रेंड",
    rating_trend_desc: "समय के साथ औसत रेटिंग",
    total_ratings: "कुल रेटिंग",
    total_ratings_desc: "समय के साथ रेटिंग की संख्या",
    review_highlights: "रिव्यू हाइलाइट्स",
    review_highlights_desc: "हाल के रिव्यू की मुख्य बातें",
    scope: "स्कोप",
    data: "डेटा",
    languages: "भाषाएँ",
    lang_en: "अंग्रेज़ी",
    lang_es: "स्पैनिश",
    lang_de: "जर्मन",
    m_jan: "जन",
    m_feb: "फ़र",
    m_mar: "मार्च",
    m_apr: "अप्रै",
    m_may: "मई",
    m_jun: "जून",
    m_jul: "जुल",
    m_aug: "अग",
    m_sep: "सित",
    m_oct: "अक्टू",
    m_nov: "नव",
    m_dec: "दिस",
    keyword_extraction: "कीवर्ड निष्कर्षण",
    keyword_extraction_desc: "रिव्यू से महत्वपूर्ण शब्द ढूंढें",
    run_extraction: "निष्कर्षण चलाएं",
    analytics: "एनालिटिक्स",
    dashboard: "डैशबोर्ड",
    price_tracking: "कीमत ट्रैकिंग",
    reviews: "रिव्यू",
    keywords: "कीवर्ड्स",
    price: "कीमत",
    avg: "औसत",
    send_alert_if_price_below: "जब कीमत < हो तो अलर्ट भेजें",
    send_alert_if_price_above: "जब कीमत > हो तो अलर्ट भेजें",
    rating: "रेटिंग",
    ratings: "रेटिंग्स",
    last_50_reviews: "आख़िरी 50 रिव्यू",
    last_100_reviews: "आख़िरी 100 रिव्यू",
    last_6_months: "पिछले 6 महीने",
    pros: "फायदे",
    cons: "कमियाँ",
    notes: "नोट्स",
    weekly_views_vs_conversions: "साप्ताहिक व्यूज़ बनाम कन्वर्ज़न",
    views: "व्यूज़",
    conversions: "कन्वर्ज़न",
    benchmarks: "बेंचमार्क",
    category_comparison: "श्रेणी तुलना",
    ctr: "CTR",
    conversion_rate: "कन्वर्ज़न",
    refund_rate: "रिफंड दर",
    source: "स्रोत",
    language: "भाषा",
    n_grams: "एन-ग्राम",
    combinations: "कॉम्बिनेशंस",
    unigrams: "यूनिग्राम",
    bigrams: "बाइग्राम",
    uni_bi: "यूनि + बाइ",
    uni_bi_tri: "यूनि + बाइ + ट्राइ",
    min_occurrences: "न्यूनतम आवृत्ति",
    stopwords: "स्टॉपवर्ड्स",
    placeholder_stopwords: "comma,separated,words",
    must_include: "यह शामिल होना चाहिए",
    placeholder_include: "जैसे battery, display",
    deduplicate_terms: "मिलते-जुलते शब्द हटाएं",
    exclude_brand_terms: "ब्रांड शब्द हटाएं",
    top_keywords: "शीर्ष कीवर्ड्स",
    sorted_by_importance: "महत्त्व के अनुसार क्रमबद्ध",
    all_reviews: "सभी रिव्यू",
    recent_reviews: "हाल के रिव्यू",
    qa: "प्रश्नोत्तर",
  },
  bn: {
    open_extension: "এক্সটেনশন খুলুন",
    search_placeholder: "পণ্য, ASIN, URL খুঁজুন...",
    connected: "সংযুক্ত",
    alerts: "অ্যালার্ট",
    price_history: "দাম ইতিহাস",
    price_history_desc: "গত বছরের দাম বনাম গড়",
    range: "রেঞ্জ",
    last_30_days: "শেষ ৩০ দিন",
    last_90_days: "শেষ ৯০ দিন",
    last_12_months: "শেষ ১২ মাস",
    price_alerts: "দাম অ্যালার্ট",
    price_alerts_desc: "দাম সীমা অতিক্রম করলে জানুন",
    alert_below: "নিচে হলে অ্যালার্ট",
    alert_above: "উপরে হলে অ্যালার্ট",
    save_alerts: "অ্যালার্ট সংরক্ষণ",
    rating_trend: "রেটিং প্রবণতা",
    rating_trend_desc: "সময়ের সাথে গড় রেটিং",
    total_ratings: "মোট রেটিং",
    total_ratings_desc: "সময়ের সাথে রেটিং সংখ্যা",
    review_highlights: "রিভিউ হাইলাইটস",
    review_highlights_desc: "সাম্প্রতিক রিভিউ থেকে প্রধান থিম",
    scope: "স্কোপ",
    data: "ডাটা",
    languages: "ভাষা",
    lang_en: "ইংরেজি",
    lang_es: "স্প্যানিশ",
    lang_de: "জার্মান",
    m_jan: "জান",
    m_feb: "ফেব",
    m_mar: "মার্চ",
    m_apr: "এপ্রি",
    m_may: "মে",
    m_jun: "জুন",
    m_jul: "জুল",
    m_aug: "আগ",
    m_sep: "সেপ",
    m_oct: "অক্টো",
    m_nov: "নভে",
    m_dec: "ডিসে",
    keyword_extraction: "কীওয়ার্ড এক্সট্রাকশন",
    keyword_extraction_desc: "রিভিউ থেকে গুরুত্বপূর্ণ শব্দ খুঁজুন",
    run_extraction: "এক্সট্রাকশন চালান",
    analytics: "অ্যানালিটিক্স",
    dashboard: "ড্যাশবোর্ড",
    price_tracking: "দাম ট্র্যাকিং",
    reviews: "রিভিউ",
    keywords: "কীওয়ার্ড",
    price: "দাম",
    avg: "গড়",
    send_alert_if_price_below: "দাম < হলে অ্যালার্ট পাঠান",
    send_alert_if_price_above: "দাম > হলে অ্যালার্ট পাঠান",
    rating: "রেটিং",
    ratings: "রেটিংস",
    last_50_reviews: "শেষ ৫০ রিভিউ",
    last_100_reviews: "শেষ ১০০ রিভিউ",
    last_6_months: "শেষ ৬ মাস",
    pros: "সুবিধা",
    cons: "অসুবিধা",
    notes: "নোটস",
    weekly_views_vs_conversions: "সাপ্তাহিক ভিউ বনাম কনভার্সন",
    views: "ভিউ",
    conversions: "কনভার্সন",
    benchmarks: "বেঞ্চমার্কস",
    category_comparison: "ক্যাটাগরি তুলনা",
    ctr: "CTR",
    conversion_rate: "কনভার্সন",
    refund_rate: "রিফান্ড হার",
    source: "উৎস",
    language: "ভাষা",
    n_grams: "এন-গ্রাম",
    combinations: "সমন্বয়",
    unigrams: "ইউনিগ্রাম",
    bigrams: "বাইগ্রাম",
    uni_bi: "ইউনি + বাই",
    uni_bi_tri: "ইউনি + বাই + ট্রাই",
    min_occurrences: "ন্যূনতম উপস্থিতি",
    stopwords: "স্টপওয়ার্ডস",
    placeholder_stopwords: "comma,separated,words",
    must_include: "অবশ্যই অন্তর্ভুক্ত",
    placeholder_include: "যেমন battery, display",
    deduplicate_terms: "মিলযুক্ত শব্দ বাদ দিন",
    exclude_brand_terms: "ব্র্যান্ড শব্দ বাদ দিন",
    top_keywords: "শীর্ষ কীওয়ার্ড",
    sorted_by_importance: "গুরুত্ব অনুযায়ী সাজানো",
    all_reviews: "সব রিভিউ",
    recent_reviews: "সাম্প্রতিক রিভিউ",
    qa: "প্রশ্নোত্তর",
  },
  ta: {
    open_extension: "நீட்டிப்பை திறக்க",
    search_placeholder: "பொருட்கள், ASIN, URL தேட...",
    connected: "இணைக்கப்பட்டது",
    alerts: "எச்சரிக்கைகள்",
    price_history: "விலை வரலாறு",
    price_history_desc: "கடந்த ஆண்டின் விலை vs சராசரி",
    range: "வரம்பு",
    last_30_days: "கடைசி 30 நாட்கள்",
    last_90_days: "கடைசி 90 நாட்கள்",
    last_12_months: "கடைசி 12 மாதங்கள்",
    price_alerts: "விலை எச்சரிக்கைகள்",
    price_alerts_desc: "விலை வரம்பை கடந்தால் அறிவிக்க",
    alert_below: "கீழே இருந்தால் எச்சரிக்கை",
    alert_above: "மேலே இருந்தால் எச்சரிக்கை",
    save_alerts: "எச்சரிக்கைகளை சேமிக்க",
    rating_trend: "மதிப்பீட்டு போக்கு",
    rating_trend_desc: "காலத்துடன் சராசரி மதிப்பீடு",
    total_ratings: "மொத்த மதிப்பீடுகள்",
    total_ratings_desc: "காலத்துடன் மதிப்பீடுகளின் எண்ணிக்கை",
    review_highlights: "மதிப்புரை முக்கியத்துவங்கள்",
    review_highlights_desc: "சமீபத்திய மதிப்புரைகளின் முக்கிய தீம்கள்",
    scope: "ஸ்கோப்",
    data: "தரவு",
    languages: "மொழிகள்",
    lang_en: "ஆங்கிலம்",
    lang_es: "ஸ்பானிஷ்",
    lang_de: "ஜெர்மன்",
    m_jan: "ஜன்",
    m_feb: "பிப்",
    m_mar: "மார்",
    m_apr: "ஏப்",
    m_may: "மே",
    m_jun: "ஜூன்",
    m_jul: "ஜூலை",
    m_aug: "ஆக",
    m_sep: "செப்",
    m_oct: "அக்",
    m_nov: "நவ",
    m_dec: "டிச",
    keyword_extraction: "முக்கிய சொல் பிரித்தெடுப்பு",
    keyword_extraction_desc: "மதிப்புரைகளில் இருந்து முக்கிய சொற்களை கண்டறி",
    run_extraction: "பிரித்தெடுக்க தொடங்கு",
    analytics: "பகுப்பாய்வு",
    dashboard: "டாஷ்போர்டு",
    price_tracking: "விலை கண்காணிப்பு",
    reviews: "மதிப்புரைகள்",
    keywords: "முக்கிய சொற்கள்",
    price: "விலை",
    avg: "சராசரி",
    send_alert_if_price_below: "விலை < இருந்தால் எச்சரிக்கை அனுப்பு",
    send_alert_if_price_above: "விலை > இருந்தால் எச்சரிக்கை அனுப்பு",
    rating: "மதிப்பீடு",
    ratings: "மதிப்பீடுகள்",
    last_50_reviews: "கடைசி 50 மதிப்புரைகள்",
    last_100_reviews: "கடைசி 100 மதிப்புரைகள்",
    last_6_months: "கடைசி 6 மாதங்கள்",
    pros: "நன்மைகள்",
    cons: "குறைபாடுகள்",
    notes: "குறிப்புகள்",
    weekly_views_vs_conversions: "வாராந்திர பார்வைகள் vs மாற்றங்கள்",
    views: "பார்வைகள்",
    conversions: "மாற்றங்கள்",
    benchmarks: "தர நிர்ணயங்கள்",
    category_comparison: "வகை ஒப்பீடு",
    ctr: "CTR",
    conversion_rate: "மாற்று விகிதம்",
    refund_rate: "பணத்தீர்ப்பு விகிதம்",
    source: "மூலம்",
    language: "மொழி",
    n_grams: "என்-கிராம்கள்",
    combinations: "இணைக்கைகள்",
    unigrams: "யுனிகிராம்கள்",
    bigrams: "பைகிராம்கள்",
    uni_bi: "யுனி + பை",
    uni_bi_tri: "யுனி + பை + ட்ரை",
    min_occurrences: "குறைந்தபட்ச தோற்றங்கள்",
    stopwords: "நிறுத்தச் சொற்கள்",
    placeholder_stopwords: "comma,separated,words",
    must_include: "கண்டிப்பாக சேர்க்க",
    placeholder_include: "எ.கா. battery, display",
    deduplicate_terms: "ஒத்த சொற்களை நீக்கு",
    exclude_brand_terms: "பிராண்ட் சொற்களை நீக்கு",
    top_keywords: "சிறந்த முக்கிய சொற்கள்",
    sorted_by_importance: "முக்கியத்துவம் படி வரிசைப்படுத்தப்பட்ட",
    all_reviews: "அனைத்து மதிப்புரைகள்",
    recent_reviews: "சமீபத்திய மதிப்புரைகள்",
    qa: "கேள்வி & பதில்",
  },
  te: {
    open_extension: "ఎక్స్‌టెన్షన్ తెరవండి",
    search_placeholder: "ఉత్పత్తులు, ASIN, URLలు వెతకండి...",
    connected: "కనెక్ట్ అయ్యింది",
    alerts: "హెచ్చరికలు",
    price_history: "ధర చరిత్ర",
    price_history_desc: "గత ఏడాది ధర vs సగటు",
    range: "శ్రేణి",
    last_30_days: "గత 30 రోజులు",
    last_90_days: "గత 90 రోజులు",
    last_12_months: "గత 12 నెలలు",
    price_alerts: "ధర హెచ్చరికలు",
    price_alerts_desc: "ధర పరిమితి దాటితే తెలియజేయండి",
    alert_below: "క్రింద ఉంటే హెచ్చరిక",
    alert_above: "పైన ఉంటే హెచ్చరిక",
    save_alerts: "హెచ్చరికలు సేవ్ చేయండి",
    rating_trend: "రేటింగ్ ధోరణి",
    rating_trend_desc: "కాలక్రమంలో సగటు రేటింగ్",
    total_ratings: "మొత్తం రేటింగ్లు",
    total_ratings_desc: "కాలక్రమంలో రేటింగ్ల సంఖ్య",
    review_highlights: "సమీక్ష ముఖ్యాంశాలు",
    review_highlights_desc: "ఇటీవలి సమీక్షల నుండి ముఖ్య విషయాలు",
    scope: "వ్యాప్తి",
    data: "డేటా",
    languages: "భాషలు",
    lang_en: "ఇంగ్లీష్",
    lang_es: "స్పానిష్",
    lang_de: "జర్మన్",
    m_jan: "జన",
    m_feb: "ఫిబ్ర",
    m_mar: "మార్",
    m_apr: "ఏప్రి",
    m_may: "మే",
    m_jun: "జూన్",
    m_jul: "జూలై",
    m_aug: "ఆగ",
    m_sep: "సెప్",
    m_oct: "అక్ట్",
    m_nov: "నవం",
    m_dec: "డిసె",
    keyword_extraction: "కీవర్డ్ ఎక్స్‌ట్రాక్షన్",
    keyword_extraction_desc: "సమీక్షల నుండి ముఖ్య పదాలను కనుగొనండి",
    run_extraction: "ఎక్స్‌ట్రాక్షన్ నడపండి",
    analytics: "విశ్లేషణ",
    dashboard: "డ్యాష్‌బోర్డ్",
    price_tracking: "ధర ట్రాకింగ్",
    reviews: "సమీక్షలు",
    keywords: "కీవర్డ్లు",
    price: "ధర",
    avg: "సగటు",
    send_alert_if_price_below: "ధర < ఉంటే అలర్ట్ పంపండి",
    send_alert_if_price_above: "ధర > ఉంటే అలర్ట్ పంపండి",
    rating: "రేటింగ్",
    ratings: "రేటింగ్లు",
    last_50_reviews: "చివరి 50 సమీక్షలు",
    last_100_reviews: "చివరి 100 సమీక్షలు",
    last_6_months: "గత 6 నెలలు",
    pros: "లాభాలు",
    cons: "నష్టాలు",
    notes: "గమనికలు",
    weekly_views_vs_conversions: "వారానికి వీక్షణలు vs మార్పులు",
    views: "వీక్షణలు",
    conversions: "మార్పులు",
    benchmarks: "బెంచ్‌మార్క్‌లు",
    category_comparison: "వర్గ తులన",
    ctr: "CTR",
    conversion_rate: "మార్పు రేటు",
    refund_rate: "రిఫండ్ రేటు",
    source: "మూలం",
    language: "భాష",
    n_grams: "ఎన్-గ్రామ్స్",
    combinations: "కాంబినేషన్లు",
    unigrams: "యూనిగ్రామ్స్",
    bigrams: "బైగ్రామ్స్",
    uni_bi: "యూని + బై",
    uni_bi_tri: "యూని + బై + ట్రై",
    min_occurrences: "కనిష్ట సంభవాలు",
    stopwords: "స్టాప్‌వర్డ్స్",
    placeholder_stopwords: "comma,separated,words",
    must_include: "తప్పనిసరిగా ఉండాలి",
    placeholder_include: "ఉదా: battery, display",
    deduplicate_terms: "సమనమైన పదాలను తొలగించండి",
    exclude_brand_terms: "బ్రాండ్ పదాలను మినహాయించండి",
    top_keywords: "టాప్ కీవర్డ్లు",
    sorted_by_importance: "ప్రాముఖ్యత ఆధారంగా క్రమబద్ధీకరించబడింది",
    all_reviews: "అన్ని సమీక్షలు",
    recent_reviews: "ఇటీవలి సమీక్షలు",
    qa: "ప్రశ్నలు & సమాధానాలు",
  },
};

const I18nContext = createContext<I18nContextType | null>(null);

export function I18nProvider({ children }: { children: ReactNode }) {
  const [locale, setLocale] = useState<Locale>("en");

  const t = useMemo(() => {
    const dict = dictionaries[locale] || dictionaries.en;
    return (key: string) => dict[key] ?? dictionaries.en[key] ?? key;
  }, [locale]);

  const value = useMemo<I18nContextType>(
    () => ({ locale, setLocale, t }),
    [locale, t]
  );

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error("useI18n must be used within I18nProvider");
  return ctx;
}

export function formatCurrencyINR(value: number) {
  try {
    return new Intl.NumberFormat("en-IN", { style: "currency", currency: "INR", maximumFractionDigits: 0 }).format(value);
  } catch {
    return `₹${Math.round(value).toLocaleString("en-IN")}`;
  }
}